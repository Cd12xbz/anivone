<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--<link rel="icon" href="dist/image/birthday_icon.png" type="image/png">-->
        <link rel="icon" href="dist/image/Ikon.png" type="image/png">
        <title>Countdown</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
        <style>
            /* Styling for the page layout */
            body {
                text-align: center;
                /*background: linear-gradient(to right, #ff9a9e, #fad0c4, #fbc2eb, #a18cd1);*/
                background-image: url("dist/image/Ganeo_1.jpg");
                background-size: 100%;
                color: white;
                font-weight: bold;
                height: 100vh;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                font-family: 'Poppins', sans-serif;
            }
            /* Styling for the countdown timer */
            #countdown {
                font-size: 2.5rem;
                font-weight: bold;
                background: rgba(0, 0, 0, 0.2);
                padding: 15px 30px;
                border-radius: 10px;
                box-shadow: 0px 4px 10px rgb(0, 0, 0);
            }
            /* Canvas for fireworks effect */
            canvas {
                position: fixed;
                z-index: -1;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: none;
            }
            @keyframes countdownFade {
                0% { opacity: 0; transform: scale(0.8); }
                50% { opacity: 0.5; transform: scale(1.1); }
                100% { opacity: 1; transform: scale(1); }
            }

            #countdown span {
                display: inline-block;
                min-width: 50px;
                animation: countdownFade 0.5s ease-in-out;
            }
            /* Styling for music control button */
            #musicControl {
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0, 0, 0, 0.5);
                color: white;
                border: none;
                padding: 10px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1rem;
                z-index: 10;
                display: none; /* Hidden awal, muncul jika perlu */
            }
            #musicControl:hover {
                background: rgba(0, 0, 0, 0.7);
            }
        </style>
    </head>
    <body>
        <h1 class="mb-4"><strong>Countdown</strong></h1>
        <div id="countdown"></div>
        <canvas id="fireworks"></canvas>
        <!-- Added audio element for automatic music playback -->
        <audio id="bgMusic" loop preload="auto" muted> <!-- Added muted untuk autoplay -->
            <source src="dist/Music/River Flow In You.mp3" type="audio/mpeg"> <!-- Perbaiki nama file (asumsi spasi benar) -->
            <!-- Jika punya file OGG, tambahkan: <source src="dist/Music/River Flow In You.ogg" type="audio/ogg"> -->
            Your browser does not support the audio element.
        </audio>

        <!-- Tombol kontrol musik (opsional, untuk unmute) -->
        <button id="musicControl" onclick="toggleMusic()">ðŸ”Š Unmute Sound</button>

        <script>
            // Fungsi toggle musik (unmute/play setelah user klik) - Diaktifkan kembali
            function toggleMusic() {
                const bgMusic = document.getElementById("bgMusic");
                const musicControl = document.getElementById("musicControl");
                if (bgMusic.muted) {
                    bgMusic.muted = false;
                    musicControl.textContent = "ðŸ”‡ Mute Sound";
                } else {
                    bgMusic.muted = true;
                    musicControl.textContent = "ðŸ”Š Unmute Sound";
                }
                // Pastikan playing setelah unmute
                if (bgMusic.paused) {
                    bgMusic.play().catch(error => {
                        console.log("Play failed after unmute:", error);
                    });
                }
            }

            document.addEventListener("DOMContentLoaded", function () {
                const bgMusic = document.getElementById("bgMusic");
                const musicControl = document.getElementById("musicControl");
                bgMusic.volume = 0.5; // Set volume to 50% (optional, adjust as needed)

                // Coba autoplay muted - Diaktifkan kembali
                bgMusic.play().then(() => {
                    console.log("Music autoplay started (muted)");
                    musicControl.style.display = "block"; // Tampilkan tombol unmute
                    musicControl.textContent = "ðŸ”Š Unmute Sound";
                }).catch(error => {
                    console.log("Autoplay prevented:", error);
                    musicControl.style.display = "block"; // Tampilkan tombol jika gagal
                    musicControl.textContent = "â–¶ï¸ Play Music";
                    // Set onclick untuk play manual jika autoplay gagal
                    musicControl.onclick = function() {
                        bgMusic.play().then(() => {
                            musicControl.style.display = "none"; // Sembunyikan tombol setelah play sukses
                            toggleMusic(); // Aktifkan toggle setelah play
                        }).catch(error => {
                            console.log("Manual play failed:", error);
                        });
                    };
                });

                function updateCountdown() {

                    //const targetDate = new Date('February 28, 2025 12:12:00').getTime(); Buat Uji coba Code
                    const targetDate = new Date('October 22, 2025 00:00:00').getTime();
                    const now = new Date().getTime();
                    const difference = targetDate - now;

                    if (difference <= 0) {
                        document.getElementById("countdown").innerHTML = "Happy Aniversary Sayangku Ganesia Gasalin ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨";
                        startFireworks();
                        // Opsional: Pastikan musik playing saat countdown selesai - Dengan error handling
                        if (bgMusic.paused) {
                            bgMusic.play().catch(error => {
                                console.log("Play on countdown end failed:", error);
                                // Jika gagal, tampilkan tombol lagi untuk user interaction
                                musicControl.style.display = "block";
                                musicControl.textContent = "â–¶ï¸ Play Music";
                            });
                        }
                        setTimeout(() => window.location.href = "event.html", 3500); 
                        return;
                    }

                    const days = Math.floor(difference / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((difference % (1000 * 60)) / 1000);

                    // Memasukkan angka ke dalam span agar efek animasi bisa diterapkan
                    document.getElementById("countdown").innerHTML = `
                        <span class="count-num">${days}</span> hari, 
                        <span class="count-num">${hours}</span> jam, 
                        <span class="count-num">${minutes}</span> menit, 
                        <span class="count-num">${seconds}</span> detik
                    `;
                }
                
                setInterval(updateCountdown, 1000);
                updateCountdown();

                /* Function to start fireworks animation */
                function startFireworks() {
                    const canvas = document.getElementById("fireworks");
                    const ctx = canvas.getContext("2d");
                    canvas.style.display = "block";
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;

                    const particles = [];
                    
                    /* Constructor for a firework particle */
                    function Particle(x, y, color) {
                        this.x = x;
                        this.y = y;
                        this.size = Math.random() * 5 + 1;
                        this.speedX = Math.random() * 4 - 2;
                        this.speedY = Math.random() * 4 - 2;
                        this.color = color;
                        this.alpha = 1;
                    }
                    
                    /* Update function for particle movement */
                    Particle.prototype.update = function () {
                        this.x += this.speedX;
                        this.y += this.speedY;
                        this.alpha -= 0.02;
                    };
                    
                    /* Function to create multiple firework particles */
                    function createFirework() {
                        for (let i = 0; i < 50; i++) {
                            particles.push(new Particle(canvas.width / 2, canvas.height / 2, `hsl(${Math.random() * 360}, 100%, 50%)`));
                        }
                    }
                    createFirework();
                    
                    /* Function to animate the fireworks */
                    function animate() {
                        ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        particles.forEach((particle, index) => {
                            particle.update();
                            ctx.fillStyle = particle.color;
                            ctx.globalAlpha = particle.alpha;
                            ctx.beginPath();
                            ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                            ctx.fill();
                            if (particle.alpha <= 0) particles.splice(index, 1);
                        });
                        if (particles.length > 0) requestAnimationFrame(animate);
                    }
                    animate();
                }
            });
        </script>
    </body>
</html>